<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code eãƒ©ãƒ¼ãƒ‹ãƒ³ã‚° - ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 2em;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .main-content {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .tabs {
            background: white;
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .tab-buttons {
            display: flex;
            background: #ecf0f1;
        }

        .tab-button {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .tab-button.active {
            background: white;
            color: #34495e;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-not-started {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .status-in-progress {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-submitted {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #34495e;
            color: white;
        }

        .btn-primary:hover {
            background: #2c3e50;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-info {
            background: #3498db;
            color: white;
        }

        .btn-info:hover {
            background: #2980b9;
        }

        .add-user-form {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Noto Sans JP', sans-serif;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #34495e;
        }

        .progress-chart {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .lesson-progress {
            margin-bottom: 20px;
        }

        .lesson-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: #ecf0f1;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #34495e, #2c3e50);
            height: 100%;
            transition: width 0.3s ease;
        }

        .demo-evidence {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #34495e;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .tab-buttons {
                flex-direction: column;
            }

            .overview-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .table {
                font-size: 0.9em;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>ğŸ”§ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <div class="user-info">
                <span class="user-name" id="admin-name">ç®¡ç†è€…</span>
                <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab('overview')">ğŸ“Š æ¦‚è¦</button>
                <button class="tab-button" onclick="showTab('users')">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</button>
                <button class="tab-button" onclick="showTab('progress')">ğŸ“š å­¦ç¿’é€²æ—</button>
                <button class="tab-button" onclick="showTab('demonstrations')">ğŸ¯ å®Ÿæ¼”ç®¡ç†</button>
            </div>

            <!-- æ¦‚è¦ã‚¿ãƒ– -->
            <div id="overview" class="tab-content active">
                <h2>ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦</h2>
                <div class="overview-stats" id="overview-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-users">0</div>
                        <div class="stat-label">ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="active-learners">0</div>
                        <div class="stat-label">å­¦ç¿’ä¸­ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completed-courses">0</div>
                        <div class="stat-label">ã‚³ãƒ¼ã‚¹å®Œäº†è€…</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-demos">0</div>
                        <div class="stat-label">æ‰¿èªå¾…ã¡å®Ÿæ¼”</div>
                    </div>
                </div>

                <div class="progress-chart">
                    <h3>å…¨ä½“å­¦ç¿’é€²æ—</h3>
                    <div id="overall-progress">
                        <!-- JavaScriptã§ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚¿ãƒ– -->
            <div id="users" class="tab-content">
                <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2>
                
                <div class="add-user-form">
                    <h3>æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</h3>
                    <form id="add-user-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>ç¤¾å“¡ID</label>
                                <input type="text" name="employee_id" required>
                            </div>
                            <div class="form-group">
                                <label>æ°å</label>
                                <input type="text" name="name" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                                <input type="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label>éƒ¨ç½²</label>
                                <input type="text" name="department">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                            <input type="password" name="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</button>
                    </form>
                </div>

                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ç¤¾å“¡ID</th>
                                <th>æ°å</th>
                                <th>ãƒ¡ãƒ¼ãƒ«</th>
                                <th>éƒ¨ç½²</th>
                                <th>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="users-table">
                            <!-- JavaScriptã§ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- å­¦ç¿’é€²æ—ã‚¿ãƒ– -->
            <div id="progress" class="tab-content">
                <h2>å­¦ç¿’é€²æ—ç®¡ç†</h2>
                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                                <th>éƒ¨ç½²</th>
                                <th>ãƒ¬ãƒƒã‚¹ãƒ³1</th>
                                <th>ãƒ¬ãƒƒã‚¹ãƒ³2</th>
                                <th>ãƒ¬ãƒƒã‚¹ãƒ³3</th>
                                <th>ãƒ¬ãƒƒã‚¹ãƒ³4</th>
                                <th>ãƒ¬ãƒƒã‚¹ãƒ³5</th>
                                <th>å…¨ä½“é€²æ—</th>
                            </tr>
                        </thead>
                        <tbody id="progress-table">
                            <!-- JavaScriptã§ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- å®Ÿæ¼”ç®¡ç†ã‚¿ãƒ– -->
            <div id="demonstrations" class="tab-content">
                <h2>å®Ÿæ¼”è¨˜éŒ²ç®¡ç†</h2>
                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                                <th>ãƒ¬ãƒƒã‚¹ãƒ³</th>
                                <th>èª²é¡Œ</th>
                                <th>æå‡ºæ—¥æ™‚</th>
                                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="demonstrations-table">
                            <!-- JavaScriptã§ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- å®Ÿæ¼”è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="demo-modal" class="modal">
        <div class="modal-content">
            <h3>å®Ÿæ¼”è¨˜éŒ²è©³ç´°</h3>
            <div id="demo-detail">
                <!-- JavaScriptã§ç”Ÿæˆ -->
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-success" onclick="approveDemonstration()">æ‰¿èª</button>
                <button class="btn btn-danger" onclick="rejectDemonstration()">å´ä¸‹</button>
                <button class="btn" onclick="closeModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentUser = null;
        let currentDemoId = null;

        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        async function checkAuth() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                window.location.href = '/login.html';
                return false;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/verify-token`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    
                    if (userData.role !== 'admin') {
                        alert('ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™');
                        window.location.href = '/student-dashboard.html';
                        return false;
                    }
                    
                    currentUser = userData;
                    document.getElementById('admin-name').textContent = `ç®¡ç†è€…`;
                    return true;
                } else {
                    // ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = '/login.html';
                    return false;
                }
            } catch (error) {
                console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = '/login.html';
                return false;
            }
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabId) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            switch(tabId) {
                case 'overview':
                    loadOverview();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'progress':
                    loadProgress();
                    break;
                case 'demonstrations':
                    loadDemonstrations();
                    break;
            }
        }

        // æ¦‚è¦ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadOverview() {
            try {
                const token = localStorage.getItem('token');
                const [usersRes, progressRes, demosRes] = await Promise.all([
                    fetch(`${API_BASE}/api/admin/users`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/progress`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/demonstrations`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    })
                ]);

                const users = await usersRes.json();
                const progress = await progressRes.json();
                const demonstrations = await demosRes.json();

                // çµ±è¨ˆæ›´æ–°
                const studentUsers = users.filter(u => u.role !== 'admin');
                document.getElementById('total-users').textContent = studentUsers.length;
                
                // å­¦ç¿’ä¸­ãƒ¦ãƒ¼ã‚¶ãƒ¼: å°‘ãªãã¨ã‚‚1ã¤ã®ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é–‹å§‹ã—ãŸãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
                const activeUserIds = new Set(progress.map(p => p.user_id));
                document.getElementById('active-learners').textContent = activeUserIds.size;
                
                // å…¨ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†è€…: 5ãƒ¬ãƒƒã‚¹ãƒ³å…¨ã¦ã‚’å®Œäº†ã—ãŸãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
                const userProgress = {};
                progress.forEach(p => {
                    if (!userProgress[p.user_id]) {
                        userProgress[p.user_id] = new Set();
                    }
                    if (p.status === 'completed') {
                        userProgress[p.user_id].add(p.lesson_id);
                    }
                });
                const completedUsers = Object.values(userProgress).filter(lessons => lessons.size === 5).length;
                document.getElementById('completed-courses').textContent = completedUsers;
                
                document.getElementById('pending-demos').textContent = demonstrations.filter(d => d.status === 'submitted').length;

                // å…¨ä½“é€²æ—ãƒãƒ£ãƒ¼ãƒˆ
                renderOverallProgress(progress, users);

            } catch (error) {
                console.error('æ¦‚è¦ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿å¤±æ•—:', error);
            }
        }

        // å…¨ä½“é€²æ—ãƒãƒ£ãƒ¼ãƒˆ
        function renderOverallProgress(progress, users) {
            const lessonNames = ['ãƒ¬ãƒƒã‚¹ãƒ³1', 'ãƒ¬ãƒƒã‚¹ãƒ³2', 'ãƒ¬ãƒƒã‚¹ãƒ³3', 'ãƒ¬ãƒƒã‚¹ãƒ³4', 'ãƒ¬ãƒƒã‚¹ãƒ³5'];
            const container = document.getElementById('overall-progress');
            
            const lessonProgress = lessonNames.map((name, index) => {
                const lessonId = index + 1;
                const completed = progress.filter(p => p.lesson_id === lessonId && p.status === 'completed').length;
                const total = users.filter(u => u.role !== 'admin').length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                return `
                    <div class="lesson-progress">
                        <div class="lesson-title">${name} (${completed}/${total}äººå®Œäº†)</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = lessonProgress;
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§èª­ã¿è¾¼ã¿
        async function loadUsers() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/api/admin/users`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const users = await response.json();
                const tableBody = document.getElementById('users-table');
                
                tableBody.innerHTML = users.filter(u => u.role !== 'admin').map(user => `
                    <tr>
                        <td>${user.employee_id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.department || '-'}</td>
                        <td>${user.last_login ? new Date(user.last_login).toLocaleDateString('ja-JP') : 'æœªãƒ­ã‚°ã‚¤ãƒ³'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-info btn-sm">è©³ç´°</button>
                                <button class="btn btn-danger btn-sm">å‰Šé™¤</button>
                            </div>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿å¤±æ•—:', error);
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ 
        document.getElementById('add-user-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const userData = {
                employee_id: formData.get('employee_id'),
                name: formData.get('name'),
                email: formData.get('email'),
                department: formData.get('department'),
                password: formData.get('password')
            };

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/api/register`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¾ã—ãŸ');
                    e.target.reset();
                    loadUsers();
                } else {
                    alert(result.error || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
                alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        });

        // é€²æ—ä¸€è¦§èª­ã¿è¾¼ã¿
        async function loadProgress() {
            try {
                const token = localStorage.getItem('token');
                const [progressRes, usersRes] = await Promise.all([
                    fetch(`${API_BASE}/api/admin/progress`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/users`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    })
                ]);

                const progress = await progressRes.json();
                const users = await usersRes.json();
                
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®é€²æ—ã‚’ã¾ã¨ã‚ã‚‹
                const userProgress = {};
                users.filter(u => u.role !== 'admin').forEach(user => {
                    userProgress[user.id] = {
                        user: user,
                        lessons: {}
                    };
                });

                progress.forEach(p => {
                    if (userProgress[p.user_id]) {
                        userProgress[p.user_id].lessons[p.lesson_id] = p;
                    }
                });

                const tableBody = document.getElementById('progress-table');
                tableBody.innerHTML = Object.values(userProgress).map(up => {
                    const getStatusBadge = (lessonId) => {
                        const lesson = up.lessons[lessonId];
                        if (!lesson) return '<span class="status-badge status-not-started">æœªé–‹å§‹<br><small>0%</small></span>';
                        
                        let className = 'status-not-started';
                        let text = 'æœªé–‹å§‹';
                        let progressText = '0%';
                        
                        // å‹•çš„ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã‚’å–å¾—
                        const totalSlides = lessonSlideCounts[lessonId] || 10;
                        
                        if (lesson.status === 'in_progress') {
                            className = 'status-in-progress';
                            text = 'å­¦ç¿’ä¸­';
                            const percentage = Math.round((lesson.last_slide / totalSlides) * 100);
                            progressText = `${percentage}% (${lesson.last_slide}/${totalSlides})`;
                        } else if (lesson.status === 'completed') {
                            className = 'status-completed';
                            text = 'å®Œäº†';
                            progressText = `100% (${totalSlides}/${totalSlides})`;
                        }
                        
                        return `<span class="status-badge ${className}">${text}<br><small>${progressText}</small></span>`;
                    };
                    
                    const completedCount = Object.values(up.lessons).filter(l => l.status === 'completed').length;
                    const overallProgress = Math.round((completedCount / 5) * 100);
                    
                    return `
                        <tr>
                            <td>${up.user.name}<br><small>${up.user.employee_id}</small></td>
                            <td>${up.user.department || '-'}</td>
                            <td>${getStatusBadge(1)}</td>
                            <td>${getStatusBadge(2)}</td>
                            <td>${getStatusBadge(3)}</td>
                            <td>${getStatusBadge(4)}</td>
                            <td>${getStatusBadge(5)}</td>
                            <td><strong>${overallProgress}%</strong></td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('é€²æ—ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿å¤±æ•—:', error);
            }
        }

        // å®Ÿæ¼”è¨˜éŒ²èª­ã¿è¾¼ã¿
        async function loadDemonstrations() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/api/admin/demonstrations`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const demonstrations = await response.json();
                const tableBody = document.getElementById('demonstrations-table');
                
                tableBody.innerHTML = demonstrations.map(demo => {
                    let statusClass = 'status-pending';
                    let statusText = 'å¾…æ©Ÿä¸­';
                    
                    if (demo.status === 'submitted') {
                        statusClass = 'status-submitted';
                        statusText = 'æå‡ºæ¸ˆã¿';
                    } else if (demo.status === 'approved') {
                        statusClass = 'status-approved';
                        statusText = 'æ‰¿èªæ¸ˆã¿';
                    } else if (demo.status === 'rejected') {
                        statusClass = 'status-rejected';
                        statusText = 'å´ä¸‹';
                    }
                    
                    return `
                        <tr>
                            <td>${demo.name}<br><small>${demo.employee_id}</small></td>
                            <td>ãƒ¬ãƒƒã‚¹ãƒ³${demo.lesson_id}</td>
                            <td>${demo.task_id}</td>
                            <td>${new Date(demo.submitted_at).toLocaleDateString('ja-JP')}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-info btn-sm" onclick="viewDemonstration(${demo.id})">è©³ç´°</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('å®Ÿæ¼”ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿å¤±æ•—:', error);
            }
        }

        // å®Ÿæ¼”è©³ç´°è¡¨ç¤º
        function viewDemonstration(demoId) {
            // TODO: å®Ÿæ¼”è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¡¨ç¤º
            currentDemoId = demoId;
            document.getElementById('demo-detail').innerHTML = `
                <div class="demo-evidence">
                    <p><strong>å®Ÿæ¼”å†…å®¹:</strong></p>
                    <p>ã‚µãƒ³ãƒ—ãƒ«å®Ÿæ¼”å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</p>
                </div>
                <div class="form-group">
                    <label>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</label>
                    <textarea id="feedback-text" rows="4" placeholder="ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>
            `;
            document.getElementById('demo-modal').style.display = 'block';
        }

        // å®Ÿæ¼”æ‰¿èª
        async function approveDemonstration() {
            await updateDemonstrationStatus('approved');
        }

        // å®Ÿæ¼”å´ä¸‹
        async function rejectDemonstration() {
            await updateDemonstrationStatus('rejected');
        }

        // å®Ÿæ¼”ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        async function updateDemonstrationStatus(status) {
            const feedback = document.getElementById('feedback-text').value;
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/api/admin/demonstration/${currentDemoId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: status,
                        feedback: feedback
                    })
                });

                if (response.ok) {
                    alert(`å®Ÿæ¼”è¨˜éŒ²ã‚’${status === 'approved' ? 'æ‰¿èª' : 'å´ä¸‹'}ã—ã¾ã—ãŸ`);
                    closeModal();
                    loadDemonstrations();
                } else {
                    alert('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('å®Ÿæ¼”ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                alert('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('demo-modal').style.display = 'none';
            currentDemoId = null;
        }

        // ãƒ¬ãƒƒã‚¹ãƒ³ã®ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ãƒ‡ãƒ¼ã‚¿
        const lessonSlideCounts = {};

        // ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã‚’å‹•çš„ã«å–å¾—
        async function loadSlideCounts() {
            try {
                for (let lessonId = 1; lessonId <= 5; lessonId++) {
                    const response = await fetch(`${API_BASE}/api/lesson/${lessonId}/slide-count`);
                    if (response.ok) {
                        const data = await response.json();
                        lessonSlideCounts[lessonId] = data.totalSlides;
                        console.log(`ãƒ¬ãƒƒã‚¹ãƒ³${lessonId}: ${lessonSlideCounts[lessonId]}ã‚¹ãƒ©ã‚¤ãƒ‰`);
                    } else {
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                        lessonSlideCounts[lessonId] = 10;
                        console.warn(`ãƒ¬ãƒƒã‚¹ãƒ³${lessonId}: ã‚¹ãƒ©ã‚¤ãƒ‰æ•°å–å¾—å¤±æ•—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤(10)ã‚’ä½¿ç”¨`);
                    }
                }
            } catch (error) {
                console.error('ã‚¹ãƒ©ã‚¤ãƒ‰æ•°å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                for (let lessonId = 1; lessonId <= 5; lessonId++) {
                    lessonSlideCounts[lessonId] = 10;
                }
            }
        }

        // åˆæœŸåŒ–
        async function init() {
            if (!checkAuth()) return;
            
            // ã‚¹ãƒ©ã‚¤ãƒ‰æ•°ã‚’æœ€åˆã«å–å¾—
            await loadSlideCounts();
            
            loadOverview();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>