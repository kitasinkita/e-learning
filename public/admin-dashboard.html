<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code e„É©„Éº„Éã„É≥„Ç∞ - ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 2em;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .main-content {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .tabs {
            background: white;
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .tab-buttons {
            display: flex;
            background: #ecf0f1;
        }

        .tab-button {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .tab-button.active {
            background: white;
            color: #34495e;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-not-started {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .status-in-progress {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-submitted {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #34495e;
            color: white;
        }

        .btn-primary:hover {
            background: #2c3e50;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-info {
            background: #3498db;
            color: white;
        }

        .btn-info:hover {
            background: #2980b9;
        }

        .add-user-form {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Noto Sans JP', sans-serif;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #34495e;
        }

        .progress-chart {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .lesson-progress {
            margin-bottom: 20px;
        }

        .lesson-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: #ecf0f1;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #34495e, #2c3e50);
            height: 100%;
            transition: width 0.3s ease;
        }

        .demo-evidence {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #34495e;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .tab-buttons {
                flex-direction: column;
            }

            .overview-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .table {
                font-size: 0.9em;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>üîß ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h1>
            <div class="user-info">
                <span class="user-name" id="admin-name">ÁÆ°ÁêÜËÄÖ</span>
                <button class="logout-btn" onclick="logout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- „Çø„Éñ„É°„Éã„É•„Éº -->
        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab('overview')">üìä Ê¶ÇË¶Å</button>
                <button class="tab-button" onclick="showTab('users')">üë• „É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ</button>
                <button class="tab-button" onclick="showTab('progress')">üìö Â≠¶ÁøíÈÄ≤Êçó</button>
                <button class="tab-button" onclick="showTab('demonstrations')">üéØ ÂÆüÊºîÁÆ°ÁêÜ</button>
            </div>

            <!-- Ê¶ÇË¶Å„Çø„Éñ -->
            <div id="overview" class="tab-content active">
                <h2>„Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å</h2>
                <div class="overview-stats" id="overview-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-users">0</div>
                        <div class="stat-label">ÁôªÈå≤„É¶„Éº„Ç∂„ÉºÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="active-learners">0</div>
                        <div class="stat-label">Â≠¶Áøí‰∏≠„É¶„Éº„Ç∂„Éº</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completed-courses">0</div>
                        <div class="stat-label">„Ç≥„Éº„ÇπÂÆå‰∫ÜËÄÖ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-demos">0</div>
                        <div class="stat-label">ÊâøË™çÂæÖ„Å°ÂÆüÊºî</div>
                    </div>
                </div>

                <div class="progress-chart">
                    <h3>ÂÖ®‰ΩìÂ≠¶ÁøíÈÄ≤Êçó</h3>
                    <div id="overall-progress">
                        <!-- JavaScript„ÅßÁîüÊàê -->
                    </div>
                </div>
            </div>

            <!-- „É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ„Çø„Éñ -->
            <div id="users" class="tab-content">
                <h2>„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ</h2>
                
                <div class="add-user-form">
                    <h3>Êñ∞Ë¶è„É¶„Éº„Ç∂„ÉºÁôªÈå≤</h3>
                    <form id="add-user-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Á§æÂì°ID</label>
                                <input type="text" name="employee_id" required>
                            </div>
                            <div class="form-group">
                                <label>Ê∞èÂêç</label>
                                <input type="text" name="name" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                <input type="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label>ÈÉ®ÁΩ≤</label>
                                <input type="text" name="department">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ÂàùÊúü„Éë„Çπ„ÉØ„Éº„Éâ</label>
                            <input type="password" name="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">„É¶„Éº„Ç∂„ÉºÁôªÈå≤</button>
                    </form>
                </div>

                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Á§æÂì°ID</th>
                                <th>Ê∞èÂêç</th>
                                <th>„É°„Éº„É´</th>
                                <th>ÈÉ®ÁΩ≤</th>
                                <th>ÊúÄÁµÇ„É≠„Ç∞„Ç§„É≥</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody id="users-table">
                            <!-- JavaScript„ÅßÁîüÊàê -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Â≠¶ÁøíÈÄ≤Êçó„Çø„Éñ -->
            <div id="progress" class="tab-content">
                <h2>Â≠¶ÁøíÈÄ≤ÊçóÁÆ°ÁêÜ</h2>
                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>„É¶„Éº„Ç∂„Éº</th>
                                <th>ÈÉ®ÁΩ≤</th>
                                <th>„É¨„ÉÉ„Çπ„É≥1</th>
                                <th>„É¨„ÉÉ„Çπ„É≥2</th>
                                <th>„É¨„ÉÉ„Çπ„É≥3</th>
                                <th>„É¨„ÉÉ„Çπ„É≥4</th>
                                <th>„É¨„ÉÉ„Çπ„É≥5</th>
                                <th>ÂÖ®‰ΩìÈÄ≤Êçó</th>
                            </tr>
                        </thead>
                        <tbody id="progress-table">
                            <!-- JavaScript„ÅßÁîüÊàê -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ÂÆüÊºîÁÆ°ÁêÜ„Çø„Éñ -->
            <div id="demonstrations" class="tab-content">
                <h2>ÂÆüÊºîË®òÈå≤ÁÆ°ÁêÜ</h2>
                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>„É¶„Éº„Ç∂„Éº</th>
                                <th>„É¨„ÉÉ„Çπ„É≥</th>
                                <th>Ë™≤È°å</th>
                                <th>ÊèêÂá∫Êó•ÊôÇ</th>
                                <th>„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody id="demonstrations-table">
                            <!-- JavaScript„ÅßÁîüÊàê -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- ÂÆüÊºîË©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
    <div id="demo-modal" class="modal">
        <div class="modal-content">
            <h3>ÂÆüÊºîË®òÈå≤Ë©≥Á¥∞</h3>
            <div id="demo-detail">
                <!-- JavaScript„ÅßÁîüÊàê -->
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-success" onclick="approveDemonstration()">ÊâøË™ç</button>
                <button class="btn btn-danger" onclick="rejectDemonstration()">Âç¥‰∏ã</button>
                <button class="btn" onclick="closeModal()">Èñâ„Åò„Çã</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentUser = null;
        let currentDemoId = null;

        // Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
        async function checkAuth() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                window.location.href = '/login.html';
                return false;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/verify-token`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    
                    if (userData.role !== 'admin') {
                        alert('ÁÆ°ÁêÜËÄÖÊ®©Èôê„ÅåÂøÖË¶Å„Åß„Åô');
                        window.location.href = '/student-dashboard.html';
                        return false;
                    }
                    
                    currentUser = userData;
                    document.getElementById('admin-name').textContent = `ÁÆ°ÁêÜËÄÖ`;
                    return true;
                } else {
                    // ÁÑ°Âäπ„Å™„Éà„Éº„ÇØ„É≥
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = '/login.html';
                    return false;
                }
            } catch (error) {
                console.error('Ë™çË®º„Ç®„É©„Éº:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = '/login.html';
                return false;
            }
        }

        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function showTab(tabId) {
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
            switch(tabId) {
                case 'overview':
                    loadOverview();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'progress':
                    loadProgress();
                    break;
                case 'demonstrations':
                    loadDemonstrations();
                    break;
            }
        }

        // Ê¶ÇË¶Å„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadOverview() {
            try {
                const token = localStorage.getItem('token');
                const [usersRes, progressRes, demosRes] = await Promise.all([
                    fetch(`${API_BASE}/api/admin/users`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/progress`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/demonstrations`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    })
                ]);

                const users = await usersRes.json();
                const progress = await progressRes.json();
                const demonstrations = await demosRes.json();

                // Áµ±Ë®àÊõ¥Êñ∞
                const studentUsers = users.filter(u => u.role !== 'admin');
                document.getElementById('total-users').textContent = studentUsers.length;
                
                // Â≠¶Áøí‰∏≠„É¶„Éº„Ç∂„Éº: Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅÆ„É¨„ÉÉ„Çπ„É≥„ÇíÈñãÂßã„Åó„Åü„É¶„Éã„Éº„ÇØ„É¶„Éº„Ç∂„ÉºÊï∞
                const activeUserIds = new Set(progress.map(p => p.user_id));
                document.getElementById('active-learners').textContent = activeUserIds.size;
                
                // ÂÖ®„É¨„ÉÉ„Çπ„É≥ÂÆå‰∫ÜËÄÖ: 5„É¨„ÉÉ„Çπ„É≥ÂÖ®„Å¶„ÇíÂÆå‰∫Ü„Åó„Åü„É¶„Éã„Éº„ÇØ„É¶„Éº„Ç∂„ÉºÊï∞
                const userProgress = {};
                progress.forEach(p => {
                    if (!userProgress[p.user_id]) {
                        userProgress[p.user_id] = new Set();
                    }
                    if (p.status === 'completed') {
                        userProgress[p.user_id].add(p.lesson_id);
                    }
                });
                const completedUsers = Object.values(userProgress).filter(lessons => lessons.size === 5).length;
                document.getElementById('completed-courses').textContent = completedUsers;
                
                document.getElementById('pending-demos').textContent = demonstrations.filter(d => d.status === 'submitted').length;

                // ÂÖ®‰ΩìÈÄ≤Êçó„ÉÅ„É£„Éº„Éà
                renderOverallProgress(progress, users);

            } catch (error) {
                console.error('Ê¶ÇË¶Å„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂ§±Êïó:', error);
            }
        }

        // ÂÖ®‰ΩìÈÄ≤Êçó„ÉÅ„É£„Éº„Éà
        function renderOverallProgress(progress, users) {
            const lessonNames = ['„É¨„ÉÉ„Çπ„É≥1', '„É¨„ÉÉ„Çπ„É≥2', '„É¨„ÉÉ„Çπ„É≥3', '„É¨„ÉÉ„Çπ„É≥4', '„É¨„ÉÉ„Çπ„É≥5'];
            const container = document.getElementById('overall-progress');
            
            const lessonProgress = lessonNames.map((name, index) => {
                const lessonId = index + 1;
                const completed = progress.filter(p => p.lesson_id === lessonId && p.status === 'completed').length;
                const total = users.filter(u => u.role !== 'admin').length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                return `
                    <div class="lesson-progress">
                        <div class="lesson-title">${name} (${completed}/${total}‰∫∫ÂÆå‰∫Ü)</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = lessonProgress;
        }

        // „É¶„Éº„Ç∂„Éº‰∏ÄË¶ßË™≠„ÅøËæº„Åø
        async function loadUsers() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/api/admin/users`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const users = await response.json();
                const tableBody = document.getElementById('users-table');
                
                tableBody.innerHTML = users.filter(u => u.role !== 'admin').map(user => `
                    <tr>
                        <td>${user.employee_id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.department || '-'}</td>
                        <td>${user.last_login ? new Date(user.last_login).toLocaleDateString('ja-JP') : 'Êú™„É≠„Ç∞„Ç§„É≥'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-info btn-sm">Ë©≥Á¥∞</button>
                                <button class="btn btn-danger btn-sm">ÂâäÈô§</button>
                            </div>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('„É¶„Éº„Ç∂„Éº„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂ§±Êïó:', error);
            }
        }

        // „É¶„Éº„Ç∂„ÉºÁôªÈå≤„Éï„Ç©„Éº„É†
        document.getElementById('add-user-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const userData = {
                employee_id: formData.get('employee_id'),
                name: formData.get('name'),
                email: formData.get('email'),
                department: formData.get('department'),
                password: formData.get('password')
            };

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/api/register`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert('„É¶„Éº„Ç∂„Éº„ÅåÊ≠£Â∏∏„Å´ÁôªÈå≤„Åï„Çå„Åæ„Åó„Åü');
                    e.target.reset();
                    loadUsers();
                } else {
                    alert(result.error || 'ÁôªÈå≤„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('„É¶„Éº„Ç∂„ÉºÁôªÈå≤„Ç®„É©„Éº:', error);
                alert('ÁôªÈå≤„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        });

        // ÈÄ≤Êçó‰∏ÄË¶ßË™≠„ÅøËæº„Åø
        async function loadProgress() {
            try {
                const token = localStorage.getItem('token');
                const [progressRes, usersRes] = await Promise.all([
                    fetch(`${API_BASE}/api/admin/progress`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/users`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    })
                ]);

                const progress = await progressRes.json();
                const users = await usersRes.json();
                
                // „É¶„Éº„Ç∂„Éº„Åî„Å®„ÅÆÈÄ≤Êçó„Çí„Åæ„Å®„ÇÅ„Çã
                const userProgress = {};
                users.filter(u => u.role !== 'admin').forEach(user => {
                    userProgress[user.id] = {
                        user: user,
                        lessons: {}
                    };
                });

                progress.forEach(p => {
                    if (userProgress[p.user_id]) {
                        userProgress[p.user_id].lessons[p.lesson_id] = p;
                    }
                });

                const tableBody = document.getElementById('progress-table');
                tableBody.innerHTML = Object.values(userProgress).map(up => {
                    const getStatusBadge = (lessonId) => {
                        const lesson = up.lessons[lessonId];
                        if (!lesson) return '<span class="status-badge status-not-started">Êú™ÈñãÂßã<br><small>0%</small></span>';
                        
                        let className = 'status-not-started';
                        let text = 'Êú™ÈñãÂßã';
                        let progressText = '0%';
                        
                        // ÂãïÁöÑ„Çπ„É©„Ç§„ÉâÊï∞„ÇíÂèñÂæó
                        const totalSlides = lessonSlideCounts[lessonId] || 10;
                        
                        if (lesson.status === 'in_progress') {
                            className = 'status-in-progress';
                            text = 'Â≠¶Áøí‰∏≠';
                            const percentage = Math.round((lesson.last_slide / totalSlides) * 100);
                            progressText = `${percentage}% (${lesson.last_slide}/${totalSlides})`;
                        } else if (lesson.status === 'completed') {
                            className = 'status-completed';
                            text = 'ÂÆå‰∫Ü';
                            progressText = `100% (${totalSlides}/${totalSlides})`;
                        }
                        
                        return `<span class="status-badge ${className}">${text}<br><small>${progressText}</small></span>`;
                    };
                    
                    const completedCount = Object.values(up.lessons).filter(l => l.status === 'completed').length;
                    const overallProgress = Math.round((completedCount / 5) * 100);
                    
                    return `
                        <tr>
                            <td>${up.user.name}<br><small>${up.user.employee_id}</small></td>
                            <td>${up.user.department || '-'}</td>
                            <td>${getStatusBadge(1)}</td>
                            <td>${getStatusBadge(2)}</td>
                            <td>${getStatusBadge(3)}</td>
                            <td>${getStatusBadge(4)}</td>
                            <td>${getStatusBadge(5)}</td>
                            <td><strong>${overallProgress}%</strong></td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂ§±Êïó:', error);
            }
        }

        // ÂÆüÊºîË®òÈå≤Ë™≠„ÅøËæº„Åø
        async function loadDemonstrations() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/api/admin/demonstrations`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const demonstrations = await response.json();
                const tableBody = document.getElementById('demonstrations-table');
                
                tableBody.innerHTML = demonstrations.map(demo => {
                    let statusClass = 'status-pending';
                    let statusText = 'ÂæÖÊ©ü‰∏≠';
                    
                    if (demo.status === 'submitted') {
                        statusClass = 'status-submitted';
                        statusText = 'ÊèêÂá∫Ê∏à„Åø';
                    } else if (demo.status === 'approved') {
                        statusClass = 'status-approved';
                        statusText = 'ÊâøË™çÊ∏à„Åø';
                    } else if (demo.status === 'rejected') {
                        statusClass = 'status-rejected';
                        statusText = 'Âç¥‰∏ã';
                    }
                    
                    return `
                        <tr>
                            <td>${demo.name}<br><small>${demo.employee_id}</small></td>
                            <td>„É¨„ÉÉ„Çπ„É≥${demo.lesson_id}</td>
                            <td>${demo.task_id}</td>
                            <td>${new Date(demo.submitted_at).toLocaleDateString('ja-JP')}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-info btn-sm" onclick="viewDemonstration(${demo.id})">Ë©≥Á¥∞</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('ÂÆüÊºî„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂ§±Êïó:', error);
            }
        }

        // ÂÆüÊºîË©≥Á¥∞Ë°®Á§∫
        function viewDemonstration(demoId) {
            // TODO: ÂÆüÊºîË©≥Á¥∞„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶Ë°®Á§∫
            currentDemoId = demoId;
            document.getElementById('demo-detail').innerHTML = `
                <div class="demo-evidence">
                    <p><strong>ÂÆüÊºîÂÜÖÂÆπ:</strong></p>
                    <p>„Çµ„É≥„Éó„É´ÂÆüÊºîÂÜÖÂÆπ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...</p>
                </div>
                <div class="form-group">
                    <label>„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ</label>
                    <textarea id="feedback-text" rows="4" placeholder="„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
                </div>
            `;
            document.getElementById('demo-modal').style.display = 'block';
        }

        // ÂÆüÊºîÊâøË™ç
        async function approveDemonstration() {
            await updateDemonstrationStatus('approved');
        }

        // ÂÆüÊºîÂç¥‰∏ã
        async function rejectDemonstration() {
            await updateDemonstrationStatus('rejected');
        }

        // ÂÆüÊºî„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        async function updateDemonstrationStatus(status) {
            const feedback = document.getElementById('feedback-text').value;
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/api/admin/demonstration/${currentDemoId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: status,
                        feedback: feedback
                    })
                });

                if (response.ok) {
                    alert(`ÂÆüÊºîË®òÈå≤„Çí${status === 'approved' ? 'ÊâøË™ç' : 'Âç¥‰∏ã'}„Åó„Åæ„Åó„Åü`);
                    closeModal();
                    loadDemonstrations();
                } else {
                    alert('Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('ÂÆüÊºî„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞„Ç®„É©„Éº:', error);
                alert('Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeModal() {
            document.getElementById('demo-modal').style.display = 'none';
            currentDemoId = null;
        }

        // „É¨„ÉÉ„Çπ„É≥„ÅÆ„Çπ„É©„Ç§„ÉâÊï∞„Éá„Éº„Çø
        const lessonSlideCounts = {};

        // „Çπ„É©„Ç§„ÉâÊï∞„ÇíÂãïÁöÑ„Å´ÂèñÂæó
        async function loadSlideCounts() {
            try {
                for (let lessonId = 1; lessonId <= 5; lessonId++) {
                    const response = await fetch(`${API_BASE}/api/lesson/${lessonId}/slide-count`);
                    if (response.ok) {
                        const data = await response.json();
                        lessonSlideCounts[lessonId] = data.totalSlides;
                        console.log(`„É¨„ÉÉ„Çπ„É≥${lessonId}: ${lessonSlideCounts[lessonId]}„Çπ„É©„Ç§„Éâ`);
                    } else {
                        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
                        lessonSlideCounts[lessonId] = 10;
                        console.warn(`„É¨„ÉÉ„Çπ„É≥${lessonId}: „Çπ„É©„Ç§„ÉâÊï∞ÂèñÂæóÂ§±Êïó„ÄÅ„Éá„Éï„Ç©„É´„ÉàÂÄ§(10)„Çí‰ΩøÁî®`);
                    }
                }
            } catch (error) {
                console.error('„Çπ„É©„Ç§„ÉâÊï∞ÂèñÂæó„Ç®„É©„Éº:', error);
                // „Ç®„É©„ÉºÊôÇ„ÅØ„Éá„Éï„Ç©„É´„ÉàÂÄ§„ÇíË®≠ÂÆö
                for (let lessonId = 1; lessonId <= 5; lessonId++) {
                    lessonSlideCounts[lessonId] = 10;
                }
            }
        }

        // ÂàùÊúüÂåñ
        async function init() {
            if (!checkAuth()) return;
            
            // „Çπ„É©„Ç§„ÉâÊï∞„ÇíÊúÄÂàù„Å´ÂèñÂæó
            await loadSlideCounts();
            
            loadOverview();
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>